{% extends "base.html" %}

{% block title %}{{ ingredient.name }} - Food Cost Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-carrot"></i> {{ ingredient.name }}</h1>
        <a href="/ingredients" class="btn btn-secondary mb-3">
            <i class="fas fa-arrow-left"></i> Back to Ingredients
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Ingredient Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Name:</strong> {{ ingredient.name }}</p>
                        <p><strong>Category:</strong> {{ ingredient.category.name if ingredient.category else 'None' }}</p>
                        <p><strong>Vendor:</strong> {{ ingredient.vendor.name if ingredient.vendor else 'None' }}</p>
                        <p><strong>Purchase Type:</strong> 
                            <span class="badge {% if ingredient.purchase_type == 'case' %}bg-info{% else %}bg-secondary{% endif %}">
                                {{ ingredient.purchase_type.title() }}
                            </span>
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Container:</strong> {{ ingredient.purchase_unit_name }}</p>
                        <p><strong>Total Weight/Volume:</strong> {{ ingredient.purchase_weight_volume }} {{ ingredient.vendor_unit.name if ingredient.vendor_unit else '' }}</p>
                        <p><strong>Total Cost:</strong> <span class="text-success">${{ "%.2f"|format(ingredient.purchase_total_cost) }}</span></p>
                        {% if ingredient.purchase_type == 'case' and ingredient.items_per_case %}
                        <p><strong>Items per Case:</strong> {{ ingredient.items_per_case }}</p>
                        <p><strong>Weight per Item:</strong> {{ "%.3f"|format(ingredient.item_weight_volume) }} {{ ingredient.vendor_unit.name if ingredient.vendor_unit else '' }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-calculator"></i> Usage Units & Pricing</h5>
            </div>
            <div class="card-body">
                {% if ingredient.usage_units %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Usage Unit</th>
                                <th>Conversion Factor</th>
                                <th>Price per Unit</th>
                                <th>Cost Calculation</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for iu in ingredient.usage_units %}
                            <tr>
                                <td><strong>{{ iu.usage_unit.name }}</strong></td>
                                <td>{{ iu.conversion_factor }}</td>
                                <td>${{ "%.4f"|format(iu.price_per_usage_unit) }}</td>
                                <td>
                                    <small class="text-muted">
                                        ${{ "%.2f"|format(ingredient.purchase_total_cost) }} รท 
                                        ({{ ingredient.purchase_weight_volume }} ร {{ iu.conversion_factor }}) = 
                                        ${{ "%.4f"|format(iu.price_per_usage_unit) }}
                                    </small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No usage units defined for this ingredient.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-cogs"></i> Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    {% if current_user.role == "admin" %}
                    <a href="/ingredients/{{ ingredient.id }}/edit" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Edit Ingredient
                    </a>
                    <a href="/ingredients/{{ ingredient.id }}/delete" class="btn btn-danger" 
                       onclick="return confirm('Are you sure you want to delete this ingredient?')">
                        <i class="fas fa-trash"></i> Delete Ingredient
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-chart-pie"></i> Cost Breakdown</h5>
            </div>
            <div class="card-body">
                <p><strong>Purchase Cost:</strong> ${{ "%.2f"|format(ingredient.purchase_total_cost) }}</p>
                <p><strong>Weight/Volume:</strong> {{ ingredient.purchase_weight_volume }} {{ ingredient.vendor_unit.name if ingredient.vendor_unit else '' }}</p>
                {% if ingredient.purchase_type == 'case' and ingredient.items_per_case %}
                <p><strong>Cost per Item:</strong> ${{ "%.2f"|format(ingredient.purchase_total_cost / ingredient.items_per_case) }}</p>
                {% endif %}
                <p><strong>Cost per {{ ingredient.vendor_unit.name if ingredient.vendor_unit else 'Unit' }}:</strong> 
                   ${{ "%.4f"|format(ingredient.purchase_total_cost / ingredient.purchase_weight_volume) }}</p>
            </div>
        </div>
        
        {% if ingredient.usage_units %}
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-utensils"></i> Recipe Usage</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">This ingredient can be used in recipes with the following units:</p>
                <div class="d-flex flex-wrap gap-1">
                    {% for iu in ingredient.usage_units %}
                    <span class="badge bg-primary">{{ iu.usage_unit.name }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}