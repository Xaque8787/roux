{% extends "base.html" %}

{% block title %}{{ ingredient.name }} - Food Cost Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-carrot"></i> {{ ingredient.name }}</h1>
        <a href="/ingredients" class="btn btn-secondary mb-3">
            <i class="fas fa-arrow-left"></i> Back to Ingredients
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Ingredient Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Basic Information</h6>
                        <p><strong>Name:</strong> {{ ingredient.name }}</p>
                        <p><strong>Category:</strong> {{ ingredient.category.name if ingredient.category else 'None' }}</p>
                        <p><strong>Vendor:</strong> {{ ingredient.vendor.name if ingredient.vendor else 'None' }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Purchase Information</h6>
                        <p><strong>Purchase Type:</strong> 
                            <span class="badge {% if ingredient.purchase_type == 'case' %}bg-info{% else %}bg-secondary{% endif %}">
                                {{ ingredient.purchase_type.title() }}
                            </span>
                        </p>
                        <p><strong>Purchase Unit:</strong> {{ ingredient.purchase_unit_name }}</p>
                        <p><strong>Total Cost:</strong> ${{ "%.2f"|format(ingredient.purchase_total_cost) }}</p>
                        {% if ingredient.purchase_quantity_description %}
                        <p><strong>Description:</strong> {{ ingredient.purchase_quantity_description }}</p>
                        {% endif %}
                        {% if ingredient.breakable_case %}
                        <p><span class="badge bg-success">Breakable Case</span></p>
                        {% endif %}
                    </div>
                </div>
                
                {% if ingredient.purchase_type == 'case' and ingredient.items_per_case %}
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <h6>Item Information</h6>
                        <p><strong>Items per Case:</strong> {{ ingredient.items_per_case }}</p>
                        <p><strong>Item Unit Name:</strong> {{ ingredient.item_unit_name }}</p>
                        <p><strong>Cost per Item:</strong> ${{ "%.2f"|format(ingredient.item_cost) }}</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if usage_units %}
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-balance-scale"></i> Usage Units & Pricing</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Usage Unit</th>
                                <th>Conversion Factor</th>
                                <th>Price per Unit</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usage in usage_units %}
                            <tr>
                                <td>{{ usage.usage_unit.name }}</td>
                                <td>{{ usage.conversion_factor }}</td>
                                <td>${{ "%.4f"|format(usage.price_per_usage_unit) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-cogs"></i> Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    {% if current_user.role == "admin" %}
                    <a href="/ingredients/{{ ingredient.id }}/edit" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Edit Ingredient
                    </a>
                    <a href="/ingredients/{{ ingredient.id }}/delete" class="btn btn-danger" 
                       onclick="return confirm('Are you sure you want to delete this ingredient?')">
                        <i class="fas fa-trash"></i> Delete Ingredient
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        {% if ingredient.vendor %}
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-truck"></i> Vendor Information</h5>
            </div>
            <div class="card-body">
                <p><strong>{{ ingredient.vendor.name }}</strong></p>
                {% if ingredient.vendor.contact_info %}
                <p class="text-muted">{{ ingredient.vendor.contact_info }}</p>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}