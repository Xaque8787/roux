{% extends "base.html" %}

{% block title %}Edit {{ employee.full_name }} - Food Cost Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-user-edit"></i> Edit Employee: {{ employee.full_name }}</h1>
        <a href="/employees/{{ employee.id }}" class="btn btn-secondary mb-3">
            <i class="fas fa-arrow-left"></i> Back to Employee
        </a>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-edit"></i> Employee Information</h5>
            </div>
            <div class="card-body">
                <form method="post" action="/employees/{{ employee.id }}/edit">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="full_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="full_name" name="full_name" 
                                       value="{{ employee.full_name }}" required>
                            </div>
                            <div class="mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" 
                                       value="{{ employee.username }}" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">New Password (leave blank to keep current)</label>
                                <input type="password" class="form-control" id="password" name="password">
                            </div>
                            <div class="mb-3">
                                <label for="hourly_wage" class="form-label">Hourly Wage</label>
                                <input type="number" class="form-control" id="hourly_wage" name="hourly_wage" 
                                       step="0.01" value="{{ employee.hourly_wage }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="role" class="form-label">Role</label>
                                <select class="form-select" id="role" name="role" required>
                                    <option value="user" {% if employee.role == 'user' %}selected{% endif %}>Basic User</option>
                                    <option value="manager" {% if employee.role == 'manager' %}selected{% endif %}>Manager</option>
                                    <option value="admin" {% if employee.role == 'admin' %}selected{% endif %}>Admin</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                           {% if employee.is_active %}checked{% endif %}>
                                    <label class="form-check-label" for="is_active">
                                        Active Employee
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Work Schedule</label>
                                {% set schedule_days = employee.work_schedule.split(',') if employee.work_schedule else [] %}
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="monday" id="monday"
                                                   {% if 'monday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="monday">Monday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="tuesday" id="tuesday"
                                                   {% if 'tuesday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="tuesday">Tuesday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="wednesday" id="wednesday"
                                                   {% if 'wednesday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="wednesday">Wednesday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="thursday" id="thursday"
                                                   {% if 'thursday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="thursday">Thursday</label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="friday" id="friday"
                                                   {% if 'friday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="friday">Friday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="saturday" id="saturday"
                                                   {% if 'saturday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="saturday">Saturday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="work_schedule" value="sunday" id="sunday"
                                                   {% if 'sunday' in schedule_days %}checked{% endif %}>
                                            <label class="form-check-label" for="sunday">Sunday</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="/employees/{{ employee.id }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Handle work schedule checkboxes
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[action="/employees/{{ employee.id }}/edit"]');
    if (form) {
        form.addEventListener('submit', function(e) {
            const checkboxes = form.querySelectorAll('input[name="work_schedule"]:checked');
            const values = Array.from(checkboxes).map(cb => cb.value);
            
            // Create a hidden input with comma-separated values
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'work_schedule';
            hiddenInput.value = values.join(',');
            form.appendChild(hiddenInput);
            
            // Remove the checkboxes from form submission
            checkboxes.forEach(cb => cb.name = '');
        });
    }
});
</script>
{% endblock %}