{% extends "base.html" %}

{% block title %}Employees - Food Cost Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-users"></i> Employee Management</h1>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-5">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-user-plus"></i> Add New Employee</h5>
            </div>
            <div class="card-body">
                <form method="post" action="/employees/new">
                    <div class="mb-3">
                        <label for="full_name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="full_name" name="full_name" required>
                    </div>
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <div class="mb-3">
                        <label for="hourly_wage" class="form-label">Hourly Wage</label>
                        <input type="number" class="form-control" id="hourly_wage" name="hourly_wage" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Work Schedule</label>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="monday" id="monday">
                                    <label class="form-check-label" for="monday">Monday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="tuesday" id="tuesday">
                                    <label class="form-check-label" for="tuesday">Tuesday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="wednesday" id="wednesday">
                                    <label class="form-check-label" for="wednesday">Wednesday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="thursday" id="thursday">
                                    <label class="form-check-label" for="thursday">Thursday</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="friday" id="friday">
                                    <label class="form-check-label" for="friday">Friday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="saturday" id="saturday">
                                    <label class="form-check-label" for="saturday">Saturday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="work_schedule" value="sunday" id="sunday">
                                    <label class="form-check-label" for="sunday">Sunday</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="role" class="form-label">Role</label>
                        <select class="form-select" id="role" name="role" required>
                            <option value="user">Basic User</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-user-plus"></i> Add Employee
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-7">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list"></i> Employees List</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-sortable">
                        <thead>
                            <tr>
                                <th data-sortable data-sort-type="text">Name</th>
                                <th data-sortable data-sort-type="text">Username</th>
                                <th data-sortable data-sort-type="text">Role</th>
                                <th data-sortable data-sort-type="currency">Wage</th>
                                <th data-sortable data-sort-type="text">Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for employee in employees %}
                            <tr class="{% if not employee.is_active %}table-secondary{% endif %}">
                                <td>{{ employee.full_name }}</td>
                                <td>{{ employee.username }}</td>
                                <td>
                                    <span class="badge 
                                        {% if employee.role == 'admin' %}bg-danger
                                        {% elif employee.role == 'manager' %}bg-warning
                                        {% else %}bg-primary{% endif %}">
                                        {{ employee.role.title() }}
                                    </span>
                                </td>
                                <td>${{ "%.2f"|format(employee.hourly_wage) }}/hr</td>
                                <td>
                                    {% if employee.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="/employees/{{ employee.id }}" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="/employees/{{ employee.id }}/edit" class="btn btn-sm btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    {% if employee.id != current_user.id %}
                                    <a href="/employees/{{ employee.id }}/delete" class="btn btn-sm btn-danger" 
                                       onclick="return confirm('Are you sure you want to deactivate this employee?')">
                                        <i class="fas fa-user-slash"></i>
                                    </a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Handle work schedule checkboxes
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[action="/employees/new"]');
    if (form) {
        form.addEventListener('submit', function(e) {
            const checkboxes = form.querySelectorAll('input[name="work_schedule"]:checked');
            const values = Array.from(checkboxes).map(cb => cb.value);
            
            // Create a hidden input with comma-separated values
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'work_schedule';
            hiddenInput.value = values.join(',');
            form.appendChild(hiddenInput);
            
            // Remove the checkboxes from form submission
            checkboxes.forEach(cb => cb.name = '');
        });
    }
});
</script>
{% endblock %}